# Exploit Cross Tenant Sync

## Description
`exploit cross tenant sync` module hosts multiple sub-modules that exploit the [Cross Tenant Synchronization](https://learn.microsoft.com/en-us/azure/active-directory/multi-tenant-organizations/cross-tenant-synchronization-overview) feature in Entra ID allowing users to execute lateral movement and establish persistence in the target environment. 

Sub-modules under `exploit cross tenant sync` module: 

* List Currently Accessible Tenants
* List Azure2Azure Template Applications in Tenant
* Find Target Tenants in Existing Cross Tenant Access Policy
* Inspect Deployed Cross Tenant Access Policy Configuration
* Find CTS Application of a Target Tenant
* Sync User to Target Tenant
* Add User to CTS Sync Group
* Deploy backdoor using Cross Tenant Synchronization

## Trigger
```
MAAD Attack Arsenal -> "AzureAD" -> 1
```

## MITRE ATT&CK Information

| Tactic         | Technique                                                                                                                                                                                                                                     |
| -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Persistence | [Create Account: Cloud Account](https://attack.mitre.org/techniques/T1136/003/)|

## Additional Details
This module is based on the techniques discussed in this research blog: [Exploiting Cross Tenant Synchronization](https://www.vectra.ai/blog/microsoft-cross-tenant-synchronization)

Revert module changes: No

Microsoft services accessed by module:

* [Entra ID (Azure AD)](https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id)

PowerShell module used: 

* [Microsoft.Graph.Identity.SignIns](https://www.powershellgallery.com/packages/Microsoft.Graph.Identity.SignIns/2.0.0-rc3)
* [Microsoft.Graph.Applications](https://www.powershellgallery.com/packages/Microsoft.Graph.Applications/2.0.0-rc3)
* [Microsoft.Graph.Users](https://www.powershellgallery.com/packages/Microsoft.Graph.Users/2.0.0-rc3)
* [Microsoft.Graph.Groups](https://www.powershellgallery.com/packages/Microsoft.Graph.Groups/2.0.0-rc3)